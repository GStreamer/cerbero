From b65a42bfcd59c3e0d3f498a66e8c1560dbe91854 Mon Sep 17 00:00:00 2001
From: Tjitte <tjitte@zeppit.com>
Date: Tue, 23 Dec 2025 22:35:46 +0100
Subject: fix fatal no dcomp as per
 https://github.com/msys2/MINGW-packages/tree/master/mingw-w64-gtk4

---
 gdk/win32/gdkcairocontext-win32.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/gdk/win32/gdkcairocontext-win32.c b/gdk/win32/gdkcairocontext-win32.c
index 37daf72472..dbd4929ee0 100644
--- a/gdk/win32/gdkcairocontext-win32.c
+++ b/gdk/win32/gdkcairocontext-win32.c
@@ -134,8 +134,9 @@ gdk_win32_cairo_context_surface_detach (GdkDrawContext *context)
 {
   GdkWin32CairoContext *self = GDK_WIN32_CAIRO_CONTEXT (context);
   GdkSurface *surface = gdk_draw_context_get_surface (context);
+  GdkWin32Display *display = GDK_WIN32_DISPLAY (gdk_draw_context_get_display (context));
 
-  if (!GDK_SURFACE_DESTROYED (surface))
+  if (!GDK_SURFACE_DESTROYED (surface) && gdk_win32_display_get_dcomp_device (display))
     gdk_win32_surface_set_dcomp_content (GDK_WIN32_SURFACE (surface), NULL);
 
   gdk_win32_com_clear (&self->staging_texture);
-- 
2.50.1 (Apple Git-155)

