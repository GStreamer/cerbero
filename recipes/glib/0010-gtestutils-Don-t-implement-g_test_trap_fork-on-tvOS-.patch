From 487b03446c17603bb5d86c296c4ec01572aef76b Mon Sep 17 00:00:00 2001
From: Nirbheek Chauhan <nirbheek@centricular.com>
Date: Tue, 27 Jan 2026 23:21:37 +0530
Subject: [PATCH 10/14] gtestutils: Don't implement g_test_trap_fork on
 tvOS/watchOS

Those platforms do not allow calling fork()
---
 glib/gtestutils.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/glib/gtestutils.c b/glib/gtestutils.c
index a291030..24983d6 100644
--- a/glib/gtestutils.c
+++ b/glib/gtestutils.c
@@ -55,6 +55,10 @@
 #endif /* HAVE_SYS_SELECT_H */
 #include <glib/gstdio.h>
 
+#ifdef __APPLE__
+#include <TargetConditionals.h>
+#endif
+
 #include "gmain.h"
 #include "gpattern.h"
 #include "grand.h"
@@ -3853,7 +3857,7 @@ gboolean
 g_test_trap_fork (guint64        usec_timeout,
                   GTestTrapFlags test_trap_flags)
 {
-#ifdef G_OS_UNIX
+#if defined(G_OS_UNIX) && (!defined(__APPLE__) || (!TARGET_OS_TV && !TARGET_OS_WATCH))
   int stdout_pipe[2] = { -1, -1 };
   int stderr_pipe[2] = { -1, -1 };
   int errsv;
-- 
2.39.5 (Apple Git-154)

